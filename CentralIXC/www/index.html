<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Central do Assinante</title>
    <link rel="icon" href="/assets/ico.png" type="image/png">
    <style>
        /* Reset básico */
        body {
            font-family: "Arial", Helvetica, sans-serif;
            padding: 0;
            box-sizing: border-box;
            height: auto;
            margin: 0;            
            background-color: #10107A;
        }
       
        /* Container principal */
        .container-atm {
                display: flex; /* Organiza as divs lado a lado */
                flex-wrap: wrap;
                justify-content: center; /* Centraliza horizontalmente */
                align-items: center; /* Alinha verticalmente ao centro */
                padding: 20px;
                gap: 20px;
                margin-top: 20px;
                max-width: 100%;
                height: 100vh; /* Ajuste a altura conforme necessário */
            }
                        
        .auto-atendimento {
            display: none; /* Oculta a div auto-atendimento inicialmente */
            color: #ffffff;
            flex-wrap: wrap;
            justify-content: flex-start;
            max-width: 60%;
            width: 650px;
            gap: 20px;
            border-radius: 8px;
            text-align: center;
        }
    
        .auto-atendimento h1 {
            font-size: 20px;    
            text-align: center;
            display: flex;
            justify-content: center;
        }
    
        .auto-atendimento img {
            max-width: 150px;
            max-width: 100px;
            height: auto;
            margin: 5px;
            background-color: #0056b3;
            border-radius: 8px;
            padding: 25px 25px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .auto-atendimento img:hover {
            transform: scale(1.1);
        }
    
        .auto-atendimento button {
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }
    
        .auto-atendimento button img {
            display: block;
            width: 150px; /* Altere conforme necessário */
            height: auto; /* Mantém a proporção da imagem */
            transition: transform 0.3s ease;
            margin: 0 auto; /* Centraliza as imagens dentro dos botões */
            transition: transform 0.3s ease, background-color 0.3s ease;
        }
    
        .auto-atendimento button:hover img {
            transform: scale(1.1);
        }
    
        #formContainer, #ossformContainer {
position: relative;
color: #fff;
background-color: #10107A;
border-radius: 8px;
text-align: center;
padding: 50px;
max-width: 40%;
width: 250px;
}

#formContainer img, #ossformContainer img {
width: 100%;
}

#formContainer h3, #ossformContainer h3 {
font-size: x-small;
}

#formContainer h1, #ossformContainer h1 {
font-size: 25px;
}

.inputUser {
background: none;
border: none;
border-bottom: 1px solid white;
outline: none;
color: white;
font-size: 15px;
width: 100%;
letter-spacing: 2px;
}

.inputBox {
position: relative;
}

.labelinput {
position: absolute;
font-size: 12px;
top: 0px;
left: 0px;
pointer-events: none;
transition: .5s;
}

.logoutbutton button {
transition: transform 0.3s ease, background-color 0.3s ease;
}

.retorno-site button {
background: white;
width: 100px;
border: none;
padding: 10px;
color: white;
font-size: 12px;
cursor: pointer;
border-radius: 5px;
text-decoration: none;
transition: transform 0.3s ease, background-color 0.3s ease;  
}

.inputUser:focus ~ .labelinput,
.inputUser:valid ~ .labelinput {
top: -20px;
font-size: 12px;
color: dodgerblue;
}

.ul {
list-style-type: none; 
}

.formContainer button, #ossFormContainer button {
background-color: #0056b3;
width: 100%;
border: none;
padding: 10px;
color: white;
font-size: 12px;
cursor: pointer;
border-radius: 5px;
transition: transform 0.3s ease, background-color 0.3s ease;
}

.formContainer button:hover, #ossFormContainer button:hover {
background-color: #0056b3;
transform: scale(1.1);
}   

#ossFormContainer {
padding: 20px;
max-width: 300px; /* Ajuste o tamanho conforme necessário */
}

#ossFormContainer label {
display: block;
font-size: 12px;
color: white;
margin-bottom: 8px;
}

#ossFormContainer select,
#ossFormContainer textarea {
background: none;
border: 1px solid #10107A;
border-radius: 4px;
outline: none;
color: white;
font-size: 15px;
width: calc(100% - 20px);
margin-bottom: 20px;
padding: 10px;
}

.placeholder {
color: white;
}

#ossFormContainer select {
height: 40px;
}

#ossFormContainer textarea {
height: 100px;
resize: vertical;
}

    
        /* Estilos do Modal */
        .modal {
            display: none; /* Oculta o modal inicialmente */
            position: fixed;
            z-index: 1000;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 600px;
            width: 100%;
            overflow: auto;
            justify-content: center;
            align-items: center;
            height: 80%;
        }
        
        .modal-content {
            background-color: #10107A;
            color: #fff;
            margin: auto;
            font-size: 30px;
            padding: 20px;
            border: none;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
        }

        .close h3 {
            background-color: #ffffff;
            border-radius: 5px;
            color: #10107A;
            width: 70px;
            padding: 8px;
            text-align: right;
            margin: 0;
        }

        .close {
            
            font-size: 13px;
            font-weight: bold;
            transition: transform 0.3s ease;
        }

        .close:hover,
        .close:focus {
            color: #ffffff;
            transform: scale(1.1);
            text-decoration: none;
            cursor: pointer;
        }

        .textoModal {
            font-size: 12px;
            line-height: 1.5;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            list-style-type: none;
        }


.textoProfile {
width: 100%;
text-align: center;
}

.textoProfile h1 {
font-size: 24px;
font-weight: bold;
color: #fff;
}

.textoProfile p span {
font-weight: bold;
color: #fff;
}

.textoProfile p::before {
color: #fff;
font-weight: bold;
}

        .textoModal span {
            font-size: 18px;
            display: inline; /* Garante que o span não quebre a linha */
            background-color: #0056b3;
            width: auto; /* Ajusta a largura do span para o conteúdo */
            border-radius: 5px;
        }

        .textoModal h4 {
            font-size: 14px;
            margin: 0; /* Remove a margem padrão do h4 */
            padding: 0; /* Remove o preenchimento padrão do h4 */
        }

        .textoModal a {
            display: inline; /* Garante que o link não quebre a linha */
        }

        li {
            border: none; /* Remove a borda dos itens da lista */
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
        }

        ul {
            list-style-type: none; /* Remove os pontos dos itens da lista */
            padding: 0; /* Remove o padding padrão do <ul> */
            margin: 0; /* Remove a margem padrão do <ul> */
        }

        /* Estilos gerais para os itens de boletos */
        .textoModalBoletos {
    padding: 20px;
    margin-bottom: 20px;
    border: 1px solid #10107A;
    border-radius: 5px;
    background-color: #e8e7e7;
    font-size: 15px;
    text-align: center;
    color:#10107A
}

.boleto-info {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
}

.info-col {
    flex: 1;
    margin-right: 15px;
}

.info-col p {
    margin: 0;
}

.boleto-status {
    margin-bottom: 10px; /* Reduzido o espaçamento entre situação e resultado */
}

.boleto-pix-linha {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
}

.boleto-pix, .boleto-linha {
    flex: 1;
    margin-right: 15px;
}

.boleto-pix p, .boleto-linha p {
    margin: 0;
}

.btn-boleto {
    display: inline-block;
    background-color: #246ECC;
    color: #fff;
    padding: 10px;
    border-radius: 8px;
    text-decoration: none;
    transition: transform 0.3s ease, background-color 0.3s ease;
}

.btn-boleto:hover {
    background-color: #1e5bb4;
    transform: scale(1.1);
}


        /* Remove o sublinhado do link e aplica o estilo desejado */
.btn-boleto {
    background-color: #246ECC;
    color: #fff;
    padding: 10px;
    border-radius: 8px;
    text-decoration: none; /* Remove o sublinhado */
    display: inline-block; /* Permite aplicar padding e margens */
    transition: transform 0.3s ease, background-color 0.3s ease;
}

/* Efeito ao passar o mouse */
.btn-boleto:hover {
    transform: scale(1.02); /* Aumenta levemente o botão */
    background-color: #1B5AA8; /* Altera a cor de fundo */
}


         /* Estilos gerais para os itens de Outros */
         

        .textoModalOutros h2 {
            font-size: 20px;
        }

        #ossForm {
            position: relative;
            color: #fff;
            background-color: #10107A;
            border-radius: 5px;
            text-align: center;
            padding: 30px;
            max-width: 100%;
            margin: auto;
        }

        #ossForm label {
            display: block;
            font-size: 12px;
            color: white;
            margin-bottom: 8px;
        }

        #ossForm select,
        #ossForm textarea {
            background: none;
            border-radius: 10px;
            outline: none;
            color: white;
            background-color: #0056b3;
            font-size: 15px;
            width: calc(100% - 20px);
            margin-bottom: 20px;
            padding: 10px;
        }

        #ossForm select {
            height: 50px;
            
        }

        #ossForm textarea {
            height: 100px;
            resize: vertical;
        }

        #ossForm button {
            background-color: #0056b3;
            width: 100%;
            border: none;
            padding: 10px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            border-radius: 5px;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }

        #ossForm button:hover {
            background-color: #0056b3;
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
        /* Ajustes para telas menores */
        #ossformContainer {
            max-width: 50%; /* Reduz a largura máxima */
            width: auto; /* Ajusta a largura para ocupar o máximo permitido */
            padding: 15px; /* Reduz o padding para economizar espaço */
            border-radius: 20px;
            font-size: 20px;
        }

        #formContainer img {
            max-width: 240px;
            width: 100%; /* Ajusta a largura para ocupar o máximo permitido */
            padding: 15px; /* Reduz o padding para economizar espaço */
            border-radius: 20px;
            font-size: 20px;
        }

        #formContainer {
            max-width: 270px;
            width: 100%; /* Ajusta a largura para ocupar o máximo permitido */
            padding: 20px; /* Reduz o padding para economizar espaço */
            border-radius: 20px;
            font-size: 15px;
            height: auto;
        }

        .auto-atendimento {
            max-width: 100%; /* Reduz a largura máxima */
            width: 100%; /* Ajusta a largura para ocupar o máximo permitido */
            /* Reduz o padding para economizar espaço */
        }

        .textoProfile {
            max-width: 300px;
            width: 100%;
            height: auto;
            text-align: center;
            font-size: 15px;
            margin-top: -50px;
        }
        .textoProfile h1 {
            font-size: 10px;
        }
    }

    /* Botão UP Flutuante */
.up-button {
position: fixed;
bottom: 20px;
right: 20px;
width: 60px;
height: 60px;
background-color: #0056b3; /* Cor de fundo */
border-radius: 50%;
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
cursor: pointer;
z-index: 1;
display: flex;
align-items: center;
justify-content: center;
transition: background-color 0.3s;
}
.up-button img {
width: 30px;
height: 30px;
opacity: 50%;
}
.up-button:hover {
transform: scale(1.1);
opacity: 100%;
}
.up-button img:hover {
opacity: 100%;
}

.background-dinamico {
    position: absolute;
    width: 100%;
    height: 100%;
    overflow: hidden;
    z-index: -1; /* Fica atrás de outros elementos */
}

.elemento {
    position: absolute;
    width: 150px;
    height: 150px;
    opacity: 0.8;
    animation: moverElementos 10s infinite linear;
}

.elemento:nth-child(1) {
    top: 10%;
    left: 20%;
    animation-delay: 0s;
}

.elemento:nth-child(2) {
    top: 30%;
    left: 60%;
    animation-delay: 2s;
}

.elemento:nth-child(3) {
    top: 70%;
    left: 40%;
    animation-delay: 4s;
}

.elemento:nth-child(4) {
    top: 50%;
    left: 70%;
    animation-delay: 6s;
}

.elemento:nth-child(5) {
    top: 20%;
    left: 80%;
    animation-delay: 8s;
}

.elemento:nth-child(6) {
    top: 80%;
    left: 10%;
    animation-delay: 10s;
}

@keyframes moverElementos {
    0% {
        transform: translateY(0) rotate(0deg) scale(1);
    }
    50% {
        transform: translateY(-20px) rotate(180deg) scale(1.1);
    }
    100% {
        transform: translateY(0) rotate(360deg) scale(1);
    }
}

.textoModalOutros {
    padding: 20px;
    margin-bottom: 20px;
    border: 1px solid #10107A; /* Cor da borda igual ao estilo de boletos */
    border-radius: 5px;
    background-color: #e8e7e7; /* Cor de fundo igual ao estilo de boletos */
    font-size: 15px; /* Tamanho da fonte igual ao estilo de boletos */
    text-align: center; /* Alinhamento do texto igual ao estilo de boletos */
    color: #10107A; /* Cor do texto igual ao estilo de boletos */
}

.cliente-titulo {
    font-size: 24px; /* Tamanho da fonte */
    color: #10107A; /* Cor do texto */
    margin-bottom: 15px; /* Espaçamento abaixo do título */
}

.cliente-info {
    font-size: 16px; /* Tamanho da fonte */
    color: #10107A; /* Cor do texto */
}

.info-label {
    font-weight: bold; /* Negrito para rótulos */
    color: #10107A; /* Cor do texto dos rótulos */
}

.textoModalOutros {
    background-color: #f9f9f9; /* Cor de fundo leve */
    padding: 20px; /* Espaçamento interno */
    border-radius: 10px; /* Bordas arredondadas */
    border: 1px solid #ddd; /* Borda suave */
    max-width: 500px; /* Largura máxima */
    margin: auto; /* Centraliza horizontalmente */
}

.cliente-titulo {
    font-size: 24px; /* Tamanho da fonte */
    color: #10107A; /* Cor do texto */
    margin-bottom: 15px; /* Espaçamento abaixo do título */
}

.cliente-info {
    font-size: 16px; /* Tamanho da fonte */
    color: #10107A; /* Cor do texto */
}

.info-item {
    margin-bottom: 10px; /* Espaçamento entre itens */
}

.info-item strong {
    display: block; /* Faz o rótulo aparecer em linha própria */
    color: #000; /* Cor do texto dos rótulos */
    font-weight: bold; /* Negrito para rótulos */
}

.info-value {
    background-color: #bbb; /* Cor de fundo para valores */
    font-size: 17px; /* Tamanho da fonte */
    font-weight: bold; /* Negrito para valores */
    padding: 10px; /* Espaçamento interno */
    border-radius: 5px; /* Bordas arredondadas */
}

    </style> 
</head>
<body>
    <div class="container-atm" id="container-atm">

        <div class="formContainer" id="formContainer">
            <img src="/assets/logo_app_.png" alt="Logotipo">
            <form id="cpfForm">
                <br>
                <h1 style="font-style: italic; font-size: 15px;">Central do Assinante</h1>
                <br>
                <div class="inputBox">
                    <input type="text" id="cpf" name="cpf" class="inputUser" required>
                    <label for="cpf" class="labelinput" style="text-align: center;">Faça login com o seu CPF ou CNPJ:</label>
                </div>
                <br>
                <br>
                <!--<input type="text" id="pass" name="pass" placeholder="******" required>-->
                <button type="submit">Entrar na central</button>
                <br><br>
                <a href="form.html" class="retorno-site">
                    <button type="button" style="background-color: #0056b3; font-weight: bold;">Não sou cliente</button>
                </a>
                <br><br>
                <a href="planos.html" class="retorno-site">
                    <button type="button" style="background-color: #1ea30d; font-size: 20px; font-weight: bold;">Ver planos e ofertas</button>
                </a>
               
            </form>
            <br><br><br>
            <div id="result">
                <!-- O resultado da busca será exibido aqui -->
            </div>
        </div>

        <div class="auto-atendimento" id="auto-atendimento">          

            <div id="bemVindo">                
                <h1>Serviços disponíveis para você.</h1>
                <br>
                <button data-page="Contrato">
                    <img src="/assets/a_contrato_.png" alt="Contrato">
                </button>
                
                <button data-page="Boleto">
                    <img src="/assets/a_boleto_.png" alt="Boleto">
                </button>

                <button data-page="pix-pag">
                    <img src="/assets/a_boleto_.png" alt="pix-pag">
                </button>

                <button data-page="desbloqueio">
                    <img src="/assets/a_desbloqueio_.png" alt="desbloqueio">
                </button>

                <button data-page="Oss">
                    <img src="/assets/a_suporte_.png" alt="Oss">
                </button>

                <button data-page="criarOss">
                    <img src="/assets/a_cadastro_.png" alt="criarOss">
                </button>

                <button data-page="reiniciar">
                    <img src="/assets/a_desconexao_.png" alt="reiniciar">
                </button>

                <button data-page="statusConexao">
                    <img src="/assets/a_desconexao_.png" alt="status">
                </button>

                <button id="showExtratoFormButton" data-page="extratoConexao">
                    <img src="/assets/a_desconexao_.png" alt="extrato">
                </button>

                <!--<a href="https://wa.me/5583999999999">
                <button data-page="Outros">
                    <img src="/assets/a_outros_.png" alt="Outros">
                </button>
                </a>-->
            </div>
        </div>
        
        <!-- Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="close"><h3>Fechar &times;</h3></span>
                <br>
                <div id="boletoContent">
                    <!-- O conteúdo do boleto será exibido aqui -->                      
                </div>

                <div id="pixContent">
                    <!-- O conteúdo do boleto será exibido aqui -->                      
                </div> 
        
                <div id="contratoContent">
                    <!-- O conteúdo do contrato será exibido aqui -->
                </div>
        
                <div id="ossContent">
                    <!-- O conteúdo de OSS será exibido aqui -->
                </div>
        
                <div id="criarOssContent">
                    <!-- O conteúdo de criar OSS será exibido aqui -->
                </div>
                
                <div id="desbloqueioContent">
                    <!-- O conteúdo de desbloqueio será exibido aqui -->
                </div>

                <div id="reiniciarContent">
                    <!-- O conteúdo de desbloqueio será exibido aqui -->
                </div>

                <div id="statusContent">
                    <!-- O conteúdo de desbloqueio será exibido aqui -->
                </div>

                <div id="extratoContent">
                    <!-- O conteúdo de desbloqueio será exibido aqui -->
                </div>
            </div>
        </div>
    <div id="ossFormContainer" style="display: none;">
        <form id="ossForm">

            <div class="">
                <label for="assunto">Primeiro, selecione um assunto:</label>
                <select id="assunto" name="assunto" required>
                    <option value="8">Suporte técnico</option>
                    <option value="6">Financeiro</option>
                </select>
            </div>
    
            <div>
                <label for="mensagem">Como podemos te ajudar?</label>
                <textarea id="mensagem" name="mensagem" placeholder="Descreva como podemos te ajudar" required></textarea>
            </div>
    
            <!-- Campos ocultos -->
            <input type="hidden" id="id_filial" name="id_filial" class="inputUser" value="1" />
            <input type="hidden" id="origem_endereco" name="origem_endereco" class="inputUser" value="M" />
            <input type="hidden" id="status" name="status" class="inputUser" value="A" />
            <input type="hidden" id="prioridade" name="prioridade" class="inputUser" value="1" />
            <input type="hidden" id="setor" name="setor" class="inputUser" value="1" />
            <input type="hidden" id="tipo" name="tipo" class="inputUser" value="C" />
    
            <button type="submit">Abrir novo chamado</button>
        </form>
    </div>

<div class="background-dinamico">
    <svg class="elemento" viewBox="0 0 100 100">
        <circle cx="50" cy="50" r="40" fill="#0056b3"></circle>
    </svg>
    <svg class="elemento" viewBox="0 0 100 100">
        <rect x="10" y="10" width="80" height="80" fill="#10107A"></rect>
    </svg>
    <svg class="elemento" viewBox="0 0 100 100">
        <circle cx="50" cy="50" r="40" fill="orange"></circle>
    </svg>
    <svg class="elemento" viewBox="0 0 100 100">
        <polygon points="50,15 60,85 40,85" fill="#F1D213"></polygon>
    </svg>
    <svg class="elemento" viewBox="0 0 100 100">
        <rect x="10" y="45" width="80" height="10" fill="#1515A3"></rect>
        <rect x="45" y="10" width="10" height="80" fill="#1515A3"></rect>
    </svg>
    <svg class="elemento" viewBox="0 0 100 100">
        <polygon points="30,10 70,10 50,90" fill="#008FFD"></polygon>
    </svg>
</div>

<!-- Formulário para consulta de extrato de consumo (oculto inicialmente) -->
<form id="extratoForm" style="display: none;">
    <label for="cpfCnpj">CPF/CNPJ:</label>
    <input type="text" id="cpfCnpj" name="cpfCnpj" value="000.000.000-00" required>

    <label for="senha">Senha:</label>
    <input type="password" id="senha" name="senha" value="00000000000" required>

    <label for="contrato">ID do Contrato:</label>
    <input type="text" id="contrato" name="contrato" required>

    <label for="ano">Ano:</label>
    <input type="text" id="ano" name="ano" required>

    <label for="mes">Mês:</label>
    <input type="text" id="mes" name="mes" required>

    <button type="submit">Consultar Extrato</button>
</form>
   
    <script>

document.addEventListener('DOMContentLoaded', () => {
    const buttons = document.querySelectorAll('.auto-atendimento button');
    const modal = document.getElementById('myModal');
    const span = document.querySelector('.close');
    const autoAtendimento = document.getElementById('auto-atendimento');
    const cpfForm = document.getElementById("cpfForm");
    const cpfInput = document.getElementById("cpf");
    const extratoContent = document.getElementById('extratoContent');
    const showExtratoFormButton = document.getElementById('showExtratoFormButton');
    const extratoForm = document.getElementById('extratoForm');

    // Mapear botões para funções correspondentes
    const buttonActions = {
        'statusConexao': statusConexao,
        'desbloqueio': desbloqueioConfianca,
        'contrato': carregarContrato,
        'Boleto': carregarBoleto,
        'pix-pag': carregarPix,
        'Oss': carregarOss,
        'criarOss': criarOss,
        'reiniciar': reiniciarConexao,
        'extratoConexao': extratoConexao
    };

    // Atribuir eventos de clique aos botões
    buttons.forEach(button => {
        button.addEventListener('click', () => {
            const action = button.getAttribute('data-page');
            if (buttonActions[action]) {
                buttonActions[action]();
            }
        });
    });

    // Função para formatar o CPF
    function formatarCPF(cpf) {
        const cpfNumeros = cpf.replace(/\D/g, ''); // Remove qualquer caractere que não seja número
        return cpfNumeros.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
    }

    // Função para formatar e definir o CPF no campo de entrada
    function formatarInputCPF(event) {
        const cpf = event.target.value;
        event.target.value = formatarCPF(cpf);
    }

    // Adicionar evento input ao campo CPF
    if (cpfInput) {
        cpfInput.addEventListener('input', formatarInputCPF);
    }

    // Função para buscar dados do cliente e validar login
    async function buscarClientes(cpf, senha) {
    try {
        const cpfSemFormatacao = cpf.replace(/\D/g, ''); // CPF sem formatação
        const cpfFormatado = formatarCPF(cpf); // CPF formatado para exibição

        // Armazenar CPF formatado e CPF sem formatação no localStorage
        localStorage.setItem('cpfFormatado', cpfFormatado);
        localStorage.setItem('cpfSemFormatacao', cpfSemFormatacao);
        localStorage.setItem('senha', cpfSemFormatacao); // Senha é o CPF sem formatação

        console.log("Fazendo requisição para o servidor proxy...");

        const response = await fetch('http://localhost:3000/api/proxy/contratos', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                cpfcnpj: cpfSemFormatacao,
                senha: senha
            })
        });

        if (!response.ok) {
            throw new Error("Erro na requisição");
        }

        const data = await response.json();

        // Verificar a autenticação e mostrar a div auto-atendimento
        if (data.auth) {
            autoAtendimento.style.display = 'flex'; // Exibe a div auto-atendimento
            cpfForm.style.display = 'none'; // Oculta o formulário
            exibirResultado(data.contratos[0]); // Passa o primeiro contrato para exibirResultado
        } else {
            exibirResultado(null); // Exibe mensagem de erro
        }
    } catch (error) {
        console.error("Erro ao buscar clientes:", error.message);
        exibirErro("Erro ao buscar cliente.");
    }
}

    // Função para exibir o resultado da busca
function exibirResultado(cliente) {
    const resultDiv = document.getElementById("result");

    if (cliente) {
        // Armazenar o ID do contrato no localStorage
        localStorage.setItem('contratoId', cliente.contrato); // Armazenando o ID do contrato

        resultDiv.innerHTML = `<div class="textoProfile">
            <h1 style="text-align: center;">Boas vindas,<br><p>${cliente.razaosocial}!</p></h1>
            </div>
        <div class="logoutbutton">
            <button id="logoutButton">Fazer logout</button>
        </div>`;

        // Adiciona o manipulador de evento ao botão de logout
        document.getElementById("logoutButton").addEventListener("click", () => {
            // Limpar localStorage e redirecionar para a tela de login
            localStorage.removeItem('cpfFormatado');
            localStorage.removeItem('cpfSemFormatacao');
            localStorage.removeItem('senha');
            localStorage.removeItem('contratoId'); // Limpar o ID do contrato também
            window.location.href = "index.html";
        });
    } else {
        resultDiv.innerHTML = "<p>Cliente não encontrado.</p>";
        autoAtendimento.style.display = 'none';
    }
}
    // Função para exibir mensagens de erro
    function exibirErro(mensagem) {
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = `<p style="color: red;">${mensagem}</p>`;
        autoAtendimento.style.display = 'none';
    }

    // Adiciona o listener ao formulário
    if (cpfForm) {
        cpfForm.addEventListener("submit", function(event) {
            event.preventDefault();
            const cpf = document.getElementById("cpf").value; // Obtém o valor do CPF com formatação
            const senha = cpf.replace(/\D/g, ''); // Senha é o CPF sem formatação

            if (cpf && senha) {
                buscarClientes(cpf, senha);
            } else {
                exibirErro("CPF ou senha não fornecidos.");
            }
        });
    }

    // Adiciona o listener aos botões do auto-atendimento
    buttons.forEach(button => {
        button.addEventListener('click', async () => {
            const page = button.getAttribute('data-page');
            modal.style.display = "block";

            if (page === 'Contrato') {
                await carregarContrato();
            } else if (page === 'Boleto') {
                await carregarBoleto();
            } else if (page === 'pix-pag') {
                await carregarPix();
            } else if (page === 'desbloqueio') {
                await desbloqueioConfianca();
            } else if (page === 'Oss') {
                await carregarOss();
            } else if (page === 'criarOss') {
                await criarOss();
            } else if (page === 'reiniciar') {
                await reiniciarConexao();
            } else if (page === 'statusConexao') {
                await statusConexao();
            } else if (page === 'extratoConexao') {
                await extratoConexao();
            }
        });
    });

// Função para mostrar o conteúdo do contrato no modal
function mostrarContrato() {
    // Supondo que os dados do cliente sejam armazenados em uma variável após o login
    const cliente = {
        razaosocial: 'ANTONIO JOSE SILVA PINTO',
        endereco_instalacao: {
            logradouro: 'Rua Exemplo',
            numero: '123',
            bairro: 'Bairro Exemplo',
            cidade: 'Cidade Exemplo',
            uf: 'UF',
            cep: '00000-000'
        },
        planointernet: '250 Megas + Telemedicina',
        planotv: 'Plano Teste Tv NXPLAY',
        planointernet_valor: 119.00
    };

    // Cria o conteúdo HTML dinamicamente usando os valores reais da variável 'cliente'
    const contratoContent = `<div class="textoModalOutros">
    <div class="cliente-info">
        <p class="info-item">
            <strong style="color: #10107A;">Plano de Internet:</strong><br>
            <span class="info-value">${cliente.planointernet}</span>
        </p>
        <p class="info-item">
            <strong style="color: #10107A;">Plano de TV:</strong><br>
            <span class="info-value">${cliente.planotv}</span>
        </p>
        <p class="info-item">
            <strong style="color: #10107A;">Mensalidade:</strong><br>
            <span class="info-value">R$ ${cliente.planointernet_valor.toFixed(2)}</span>
        </p>
    </div>
</div>

    `;

    // Insere o conteúdo na div contratoContent dentro do modal
    document.getElementById('contratoContent').innerHTML = contratoContent;

    // Exibe o modal
    const modal = document.getElementById('myModal');
    modal.style.display = 'block';
}

// Adiciona o evento de clique ao botão para mostrar o contrato
document.querySelector('button[data-page="Contrato"]').addEventListener('click', mostrarContrato);

// Fecha o modal quando o botão de fechar é clicado
document.querySelector('.modal .close').addEventListener('click', function() {
    document.getElementById('myModal').style.display = 'none';
});

    // Função para buscar status da conexão
    async function statusConexao() {
        try {
            const response = await fetch('/proxy/statusConexao', { method: 'GET' });
            const data = await response.json();
            document.getElementById('statusContent').innerHTML = JSON.stringify(data);
            modal.style.display = 'block';
        } catch (error) {
            console.error('Erro ao buscar status da conexão:', error);
        }
    }

    // Função para desbloqueio de confiança
    async function desbloqueioConfianca() {
        try {
            const response = await fetch('/proxy/desbloqueio', { method: 'POST' });
            const data = await response.json();
            document.getElementById('desbloqueioContent').innerHTML = JSON.stringify(data);
            modal.style.display = 'block';
        } catch (error) {
            console.error('Erro ao realizar desbloqueio de confiança:', error);
        }
    }

    // Função para carregar contrato
    async function carregarContrato() {
        try {
            const response = await fetch('/proxy/contrato', { method: 'GET' });
            const data = await response.json();
            document.getElementById('contratoContent').innerHTML = JSON.stringify(data);
            modal.style.display = 'block';
        } catch (error) {
            console.error('Erro ao carregar contrato:', error);
        }
    }

                // Função para carregar boletos
        async function carregarBoleto() {
            try {
                const cpfFormatado = localStorage.getItem('cpfFormatado');
                const contratoId = localStorage.getItem('contratoId');

                if (!cpfFormatado || !contratoId) {
                    console.error('CPF ou ID do contrato não encontrado no localStorage.');
                    document.getElementById('boletoContent').innerHTML = '<p>CPF ou ID do contrato não encontrado.</p>';
                    return;
                }

                const senha = cpfFormatado.replace(/[^\d]/g, '');

                const response = await fetch('http://localhost:3000/api/proxy/titulos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        cpfcnpj: cpfFormatado,
                        senha: senha,
                        contrato: contratoId
                    })
                });

                if (!response.ok) {
                    console.error('Resposta da API não foi ok. Status:', response.status);
                    throw new Error('Erro na requisição para buscar boletos.');
                }

                const data = await response.json();

                const boletoContent = document.getElementById('boletoContent');

                if (data && Array.isArray(data.faturas) && data.faturas.length > 0) {
                    boletoContent.innerHTML = data.faturas.map(boleto => {
                        // Formata a data para dia/mês/ano
                        const vencimentoFormatado = new Date(boleto.vencimento).toLocaleDateString('pt-BR');

                        // Define a classe CSS com base no status do boleto
                        let classeStatus = '';
                        if (boleto.status === 'Pago') {
                            classeStatus = 'pago';
                        } else if (new Date(boleto.vencimento) < new Date()) {
                            classeStatus = 'vencido';
                        }

                        return `
                            <div class="textoModalBoletos ${classeStatus}">
            <div class="boleto-info">
                <div class="info-col">
                    <p><strong>ID:</strong></p>
                    <p>${boleto.numero_documento || 'Não disponível'}</p>
                </div>
                <div class="info-col">
                    <p><strong>Valor:</strong></p>
                    <p>R$ ${boleto.valor.toFixed(2)}</p>
                </div>
                <div class="info-col">
                    <p><strong>Vencimento:</strong></p>
                    <p>${vencimentoFormatado}</p>
                </div>
            </div>
            <div class="boleto-status">
                <p><strong>Status do pagamento:</strong></p>
                <p style="background-color: #bbb; font-size: 17px; font-weight: bold; padding: 10px; border-radius: 5px;">${boleto.status || 'Não disponível'}</p>
            </div>
            <div class="boleto-pix-linha">
                <div class="boleto-pix">
                    <p><strong>Pix Copia e Cola:</strong></p>
                    <p>${boleto.codigopix || 'Não disponível'}</p>
                </div><br>
                <div class="boleto-linha">
                    <p><strong>Linha Digitável:</strong></p>
                    <p>${boleto.linhadigitavel || 'Não disponível'}</p>
                </div>
            </div>
            <p><strong><a href="${boleto.link}.pdf" class="btn-boleto" target="_blank">Baixe o boleto aqui</a></strong></p>
        </div>`;
                    }).join('');
                } else {
                    boletoContent.innerHTML = '<p>Nenhum boleto encontrado.</p>';
                }

                const modal = document.getElementById('myModal');
                modal.style.display = 'block';

            } catch (error) {
                console.error('Erro ao carregar boletos:', error);
                document.getElementById('boletoContent').innerHTML = '<p>Erro ao carregar boletos.</p>';
            }
        }

    // Evento de clique no botão para mostrar o formulário
        showExtratoFormButton.addEventListener('click', () => {
            if (extratoForm.style.display === 'none' || extratoForm.style.display === '') {
                extratoForm.style.display = 'block'; // Mostra o formulário
            } else {
                extratoForm.style.display = 'none'; // Oculta o formulário
            }
        });
        
     // Função para consultar extrato
     async function consultarExtrato(cpfCnpj, senha, contrato, ano, mes) {
        const FormData = require('form-data');
        const axios = require('axios');
        const data = new FormData();
        
        data.append('cpfcnpj', cpfCnpj);
        data.append('senha', senha);
        data.append('contrato', contrato);
        data.append('ano', ano);
        data.append('mes', mes);

        const config = {
            method: 'post',
            maxBodyLength: Infinity,
            url: 'https://demo.sgp.net.br/api/central/extratouso/',
            headers: { 
                ...data.getHeaders()
            },
            data: data
        };

        try {
            const response = await axios(config);
            exibirExtrato(response.data);
        } catch (error) {
            console.error('Erro ao buscar extrato de uso:', error.message);
            exibirErro('Erro ao buscar extrato de uso.');
        }
    }

    // Função para exibir o extrato
    function exibirExtrato(extrato) {
        if (extrato) {
            extratoContent.innerHTML = `
                <h3>Extrato de Uso</h3>
                <p>Ano: ${extrato.ano}</p>
                <p>Mês: ${extrato.mes}</p>
                <p>Plano: ${extrato.plano}</p>
                <p>Login: ${extrato.login}</p>
                <p>Total: ${extrato.total}</p>
            `;
        } else {
            extratoContent.innerHTML = '<p>Nenhum extrato de uso encontrado.</p>';
        }

        modal.style.display = 'block'; // Exibe o modal com o conteúdo
    }

    // Função para exibir mensagens de erro
    function exibirErro(mensagem) {
        extratoContent.innerHTML = `<p style="color: red;">${mensagem}</p>`;
        modal.style.display = 'block';
    }

    // Adicionar o evento de submit no formulário
    extratoForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const cpfCnpj = document.getElementById('cpfCnpj').value;
        const senha = document.getElementById('senha').value;
        const contrato = document.getElementById('contrato').value;
        const ano = document.getElementById('ano').value;
        const mes = document.getElementById('mes').value;

        if (cpfCnpj && senha && contrato && ano && mes) {
            consultarExtrato(cpfCnpj, senha, contrato, ano, mes);
        } else {
            exibirErro('Todos os campos são obrigatórios.');
        }
    });
});

    // Função para carregar PIX
    async function carregarPix() {
        try {
            const response = await fetch('/proxy/pix-pag', { method: 'GET' });
            const data = await response.json();
            document.getElementById('pixContent').innerHTML = JSON.stringify(data);
            modal.style.display = 'block';
        } catch (error) {
            console.error('Erro ao carregar PIX:', error);
        }
    }

    // Função para carregar OSS
    async function carregarOss() {
        try {
            const response = await fetch('/proxy/oss', { method: 'GET' });
            const data = await response.json();
            document.getElementById('ossContent').innerHTML = JSON.stringify(data);
            modal.style.display = 'block';
        } catch (error) {
            console.error('Erro ao carregar OSS:', error);
        }
    }

    // Função para criar OSS
    async function criarOss() {
        try {
            const response = await fetch('/proxy/criar-oss', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    assunto: 'Manutenção',
                    mensagem: 'Necessário realizar manutenção.',
                    id_filial: 1,
                    origem_endereco: 'CC',
                    status: 'A',
                    prioridade: 1,
                    setor: 1,
                    tipo: 'C'
                })
            });
            const data = await response.json();
            document.getElementById('criarOssContent').innerHTML = JSON.stringify(data);
            modal.style.display = 'block';
        } catch (error) {
            console.error('Erro ao criar OSS:', error);
        }
    }

    // Função para reiniciar conexão
    async function reiniciarConexao() {
        try {
            const response = await fetch('/proxy/reiniciar', { method: 'POST' });
            const data = await response.json();
            document.getElementById('reiniciarContent').innerHTML = JSON.stringify(data);
            modal.style.display = 'block';
        } catch (error) {
            console.error('Erro ao reiniciar conexão:', error);
        }
    }

    // Função para limpar o modal
    function limparModal() {
        document.getElementById('contratoContent').innerHTML = '';
        document.getElementById('boletoContent').innerHTML = '';
        document.getElementById('pixContent').innerHTML = '';
        document.getElementById('ossContent').innerHTML = '';
        document.getElementById('criarOssContent').innerHTML = '';
        document.getElementById('reiniciarContent').innerHTML = '';
        document.getElementById('extratoContent').innerHTML = '';
    }

    // Fechar modal quando clicado no "x"
    if (span) {
        span.addEventListener('click', () => {
            modal.style.display = 'none';
            limparModal();
        });
    }

    // Fechar modal ao clicar fora dele
    window.addEventListener('click', (event) => {
        if (event.target === modal) {
            modal.style.display = 'none';
            limparModal();
        }
    });

    </script>
    <div class="up-button">
        <a href="https://wa.me/5583999999999">
        <img src="/assets/atm_ico_.png" alt="Volte ao topo">
    </a>
        </div>
</body>
</html>